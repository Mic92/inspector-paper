\section{Introduction}
\label{sec:introduction}

Data provenance provides an explicit intermediate program representation recording control and data dependencies for a program execution.  The provenance trace is useful for a wide-range of workflows to improve the dependability, security, and efficiency of software systems; including, program debugging~\cite{fast-track-pldi}, record-replay systems for parallel state-machine replication~\cite{rex},  compiler optimizations~\cite{pgo}, incremental computation~\cite{ithreads}, program slicing~\cite{roly}, memory management for NUMA architectures~\cite{memprof}, and dynamic information flow tracking~\cite{dift}, etc. 

Many existing systems provide support for data provenance (detailed in $\S$~\ref{sec:related}); however,
most target sequential programs and specific application domain, while others that do support parallelism require a new language with a restrictive programming model. Furthermore, the existing  provenance systems for parallel programs rely on manual annotations using a new type system. Thereby, limiting their wide-spread adoption.



In this paper, we propose an operating systems-based approach to data provenance for multithreaded programs. More specifically, we have the following three main design goals: 
\begin{itemize} 

\item Transparency: To support unmodified multithreaded programs without requiring any code changes to existing applications. 
\item Generality: To support the general shared-memory programming model with the  full range of synchronization primitives in the {\tt POSIX} API. 
\item Efficiency: To impose low overheads by designing the underlying provenance algorithm to be  {\em parallel} as well so that it does not limit the available application parallelism.

\end{itemize}

To achieve these goals, we present \projecttitle, a threading library for data provenance. To run a program using \projecttitle,  the user just needs to preload the \projecttitle library  by using the environment variable {\tt LD\_PRELOAD} or {\tt -rdynamic} flag, and then, run the program as usual. Thus, enabling existing binaries to benefit from our approach. 


Our approach is based on recording the data, control, and schedule dependencies in a computation by constructing a {\em Concurrent Provenance Graph} (CPG). The CPG tracks the input data to a program, all sub-computations (a sub-computation is a unit of the computation), the data flow between sub-computations, intra-thread control flow, and inter-thread schedule dependencies for the multithreaded execution. 


In this paper, we present a {\em parallel} algorithm to build the CPG. Our algorithm combines the release consistency memory model with vector clocks to record the inter-thread data and schedule dependencies in a completely decentralized  manner. We implemented our algorithm by leveraging process-level isolation, MMU-assisted memory tracking, and \intelpt ISA extensions released as part of the Broadwell architecture.



Overall, this paper makes the following contributions:
\begin{itemize}

\item We present a parallel algorithm for data provenance for multithreaded programs that records intra- and inter-thread control and data dependencies using a Concurrent Provenance Graph (CPG) ($\S$~\ref{sec:algorithms}).

\item We implemented our algorithm as a dynamically linkable shared library, which we call \projecttitle, leveraging MMU-assisted memory tracking, process-level isolation, and recently released \intelpt ISA extensions.  The \projecttitle library can be loaded and linked at run-time as a replacement to the \pthreads library, without any recompilation  of the application code ($\S$~\ref{sec:implementation}).

\item  We  empirically demonstrate  the effectiveness of \projecttitle by applying it to applications of standard multithreaded benchmark suites (PARSEC~\cite{parsec} and Phoneix~\cite{phoenix}). Our experiments show that \projecttitle~incurs reasonable overhead to derive data provenance for a majority of applications ($\S$~\ref{sec:evaluation}). 

\end{itemize}

\projecttitle is an active open-source project, and the library is publicly available to the research community. We believe that the provenance abstraction exported by \projecttitle is useful to support a wide-range of workflows in improving the dependability and security of software systems ($\S$~\ref{sec:discussion}).
